<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allocator</title>
    <script src="config.js"></script>
</head>
<body>
    <h1>Issue Allocator</h1>
    <button onclick="drawRandomIssue()">Draw</button>
    <p id="result"></p>

    <script>
        function drawRandomIssue() {
            const resultElement = document.getElementById('result');
            let totalWeight = 0;
            const weightedRanges = [];

            // Calculate the total weighted possibilities considering frequencyMod
            config.forEach(item => {
                const { username, repo, startIdx, endIdx } = item;
                const mod = frequencyMods[`${username}-${repo}`] || {};

                for (let i = startIdx; i <= endIdx; i++) {
                    let frequencyMod = mod[i] || 1; // Default to 1 if no special frequencyMod
                    let rangeWeight = frequencyMod;
                    weightedRanges.push({ username, repo, index: i, weight: rangeWeight });
                    totalWeight += rangeWeight;
                }
            });

            // Pick a random number in the total weighted range
            let randomWeight = Math.floor(Math.random() * totalWeight);
            let cumulativeWeight = 0;

            // Determine which specific index the random weight falls into
            for (let range of weightedRanges) {
                cumulativeWeight += range.weight;
                if (randomWeight < cumulativeWeight) {
                    const issueURL = `https://github.com/${range.username}/${range.repo}/issues/${range.index}`;
                    resultElement.textContent = issueURL;
                    return;
                }
            }
        }
    </script>
</body>
</html>
