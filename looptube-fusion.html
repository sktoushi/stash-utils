<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>LoopTube Fusion</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body {padding:1rem;background-color:#0d1117;color:#c9d1d9;}
  #player1,#player2{width:100%;height:100%;}
  .form-control{background-color:#161b22;color:#c9d1d9;border-color:#30363d;}
  .btn-secondary{background-color:#21262d;color:#c9d1d9;border-color:#30363d;}
  .btn-secondary:hover{background-color:#30363d;color:#c9d1d9;border-color:#30363d;}
  .btn-primary{background-color:#238636;border-color:#2ea043;}
  .btn-primary:hover{background-color:#2ea043;border-color:#238636;}
</style>
</head>
<body class="text-center" data-bs-theme="dark">
<div class="container">
  <div class="row mb-3">
    <div class="col"><input id="url1" type="text" class="form-control" placeholder="URL 1"></div>
    <div class="col-auto"><button id="load1" class="btn btn-primary">Load 1</button></div>
  </div>
  <div class="ratio ratio-16x9 mb-3" id="player1"></div>
  <div class="row mb-3">
    <div class="col"><input id="url2" type="text" class="form-control" placeholder="URL 2"></div>
    <div class="col-auto"><button id="load2" class="btn btn-primary">Load 2</button></div>
  </div>
  <div class="ratio ratio-16x9 mb-3" id="player2"></div>
  <div class="mb-3 d-flex justify-content-center align-items-center gap-2">
    <input id="segments1" type="number" class="form-control" style="max-width:6rem;" value="1" min="1">
    <input id="segments2" type="number" class="form-control" style="max-width:6rem;" value="1" min="1">
    <button id="altPlay" class="btn btn-secondary">Alternate Play</button>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://www.youtube.com/iframe_api"></script>
<script>
const urlParams=new URLSearchParams(location.search);
let player1,player2;
let altMode=false,active=1,segIdx=0,endTime=0,segLen1=0,segLen2=0;
function extractVideoId(url){
  const m=url.match(/[?&]v=([^&]+)/);if(m)return m[1];
  const m2=url.match(/youtu\.be\/([^?]+)/);if(m2)return m2[1];
  return url;
}
function onYouTubeIframeAPIReady(){
  player1=new YT.Player('player1',{events:{onReady:()=>{const u=urlParams.get('video1');if(u){document.getElementById('url1').value=u;loadVideo1(u);}}}});
  player2=new YT.Player('player2',{events:{onReady:()=>{const u=urlParams.get('video2');if(u){document.getElementById('url2').value=u;loadVideo2(u);}}}});
}
function loadVideo1(u){const id=extractVideoId(u.trim());player1.loadVideoById(id);}
function loadVideo2(u){const id=extractVideoId(u.trim());player2.loadVideoById(id);}
document.getElementById('load1').onclick=()=>loadVideo1(document.getElementById('url1').value);
document.getElementById('load2').onclick=()=>loadVideo2(document.getElementById('url2').value);
function startAlternate(){
  if(!player1||!player2)return;
  segIdx=0;active=1;altMode=true;
  segLen1=player1.getDuration()/Math.max(1,parseInt(document.getElementById('segments1').value)||1);
  segLen2=player2.getDuration()/Math.max(1,parseInt(document.getElementById('segments2').value)||1);
  playCurrent();
}
function playCurrent(){
  if(!altMode)return;
  if(active===1){
    const c=Math.max(1,parseInt(document.getElementById('segments1').value)||1);
    const start=(segIdx%c)*segLen1;
    endTime=start+segLen1;
    player1.seekTo(start,true);player1.playVideo();
  }else{
    const c=Math.max(1,parseInt(document.getElementById('segments2').value)||1);
    const start=(segIdx%c)*segLen2;
    endTime=start+segLen2;
    player2.seekTo(start,true);player2.playVideo();
  }
  checkAlt();
}
function checkAlt(){
  if(!altMode)return;
  const p=active===1?player1:player2;
  if(p.getCurrentTime()>=endTime){
    p.pauseVideo();
    if(active===2)segIdx++;
    active=active===1?2:1;
    playCurrent();
    return;
  }
  requestAnimationFrame(checkAlt);
}
document.getElementById('altPlay').onclick=startAlternate;
</script>
</body>
</html>
