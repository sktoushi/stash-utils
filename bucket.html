<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Random URL Picker with Customizable Settings</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Existing CSS styles remain unchanged */
        body {
            background-color: #f8f9fa;
        }
        body.dark-mode {
            background-color: #343a40;
            color: #f8f9fa;
        }
        .container {
            max-width: 900px;
            margin-top: 30px;
        }
        .btn-draw {
            width: 100%;
            margin-bottom: 20px;
        }
        .slider-container, .input-container {
            margin-bottom: 20px;
        }
        .slider-label {
            display: flex;
            justify-content: space-between;
        }
        .btn-export {
            margin-top: 10px;
        }
        .gauge-container {
            margin-bottom: 20px;
        }
        .bucket-list {
            max-height: 200px;
            overflow-y: auto;
        }
        .history-list {
            max-height: 200px;
            overflow-y: auto;
        }
        .dark-mode .card {
            background-color: #495057;
            color: #f8f9fa;
        }
        .dark-mode .form-control, .dark-mode .form-select {
            background-color: #6c757d;
            color: #f8f9fa;
            border: 1px solid #ced4da;
        }
        .dark-mode .btn-primary {
            background-color: #0d6efd;
            border-color: #0d6efd;
        }
        .dark-mode .btn-secondary {
            background-color: #6c757d;
            border-color: #6c757d;
        }
        /* Custom scrollbar for dark mode */
        body.dark-mode ::-webkit-scrollbar {
            width: 8px;
        }
        body.dark-mode ::-webkit-scrollbar-track {
            background: #343a40;
        }
        body.dark-mode ::-webkit-scrollbar-thumb {
            background: #6c757d;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center">Random URL Picker</h1>

        <!-- Current Mode Display -->
        <div class="text-center mb-3">
            <span id="currentMode" class="badge bg-info text-dark">Mode: Read-Only</span>
        </div>

        <!-- Theme Toggle -->
        <div class="text-end mb-3">
            <button class="btn btn-secondary" onclick="toggleDarkMode()" title="Toggle Dark Mode">
                <i class="fas fa-moon"></i> Dark Mode
            </button>
        </div>

        <!-- Help Modal Trigger -->
        <div class="text-end mb-3">
            <button class="btn btn-info" data-bs-toggle="modal" data-bs-target="#helpModal" title="Help">
                <i class="fas fa-question-circle"></i> Help
            </button>
        </div>

        <div class="input-container">
            <label class="form-label">URL Prefix:</label>
            <input type="text" class="form-control" id="urlPrefix" placeholder="Enter URL Prefix" title="Add a prefix to all URLs">
            <label class="form-label">URL Suffix:</label>
            <input type="text" class="form-control" id="urlSuffix" placeholder="Enter URL Suffix" title="Add a suffix to all URLs">
            <button class="btn btn-secondary mt-2" onclick="saveUrlPrefixSuffix()" title="Save URL Prefix and Suffix">
                Save URL Prefix/Suffix
            </button>
        </div>

        <div class="input-container">
            <label class="form-label">Default Frequency:</label>
            <div class="input-group">
                <input type="number" class="form-control" id="defaultFrequency" value="1" min="1" disabled title="Set default frequency for new items">
                <button class="btn btn-secondary" onclick="toggleDefaultFrequency()" title="Edit Default Frequency">
                    <i class="fas fa-edit"></i> Edit
                </button>
                <button class="btn btn-primary" onclick="saveDefaultFrequency()" title="Save Default Frequency">
                    <i class="fas fa-save"></i> Save
                </button>
            </div>
        </div>

        <div class="slider-container">
            <label for="probSlider" class="form-label">Adjust Probabilities:</label>
            <input type="range" class="form-range" id="probSlider" min="0" max="100" value="66" oninput="updateProbabilities()" title="Adjust the probability of selecting from Bucket 1">
            <div class="slider-label">
                <span>Bucket 1: <span id="probBucket1">66%</span></span>
                <span>Bucket 2: <span id="probBucket2">34%</span></span>
            </div>
        </div>

        <button class="btn btn-primary btn-draw" onclick="pickRandom()" title="Draw a random URL">
            <i class="fas fa-random"></i> Draw and Open URL
        </button>

        <button class="btn btn-warning btn-draw" onclick="undoLastDraw()" title="Undo the last draw">
            <i class="fas fa-undo"></i> Undo Last Draw
        </button>

        <!-- Review Gauges -->
        <div class="gauge-container">
            <label for="review1Gauge" class="form-label">Review1 (Unique Bucket1 Items / Initial Bucket2 Total):</label>
            <progress id="review1Gauge" class="form-range w-100" value="0" max="100" aria-label="Review1 Gauge"></progress>
            <div class="text-center">
                <span id="review1Text">0%</span>
            </div>
        </div>

        <div class="gauge-container">
            <label for="review2Gauge" class="form-label">Review2 (Initial Bucket2 Total - Unique Bucket1 Items):</label>
            <progress id="review2Gauge" class="form-range w-100" value="100" max="100" aria-label="Review2 Gauge"></progress>
            <div class="text-center">
                <span id="review2Text">100%</span>
            </div>
        </div>

        <!-- Bucket Lists -->
        <div class="row">
            <div class="col-md-6">
                <h5>Bucket 1 Total Frequency: <span id="bucket1Freq">0</span></h5>
                <ul class="list-group bucket-list" id="bucket1List" aria-label="Bucket 1 Items">
                    <!-- Bucket1 items will be populated here -->
                </ul>
            </div>
            <div class="col-md-6">
                <h5>Bucket 2 Total Frequency: <span id="bucket2Freq">0</span></h5>
                <ul class="list-group bucket-list" id="bucket2List" aria-label="Bucket 2 Items">
                    <!-- Bucket2 items will be populated here -->
                </ul>
            </div>
        </div>

        <!-- Draw History -->
        <div class="mt-4">
            <h5>Draw History (Last 5):</h5>
            <ul class="list-group history-list" id="historyList" aria-label="Draw History">
                <!-- History items will be populated here -->
            </ul>
        </div>

        <!-- Action Buttons -->
        <div class="text-center mt-4">
            <button class="btn btn-secondary btn-export" onclick="exportState()" title="Export current state as JSON">
                <i class="fas fa-file-export"></i> Export State
            </button>
            <button class="btn btn-secondary btn-export" onclick="importState()" title="Import state from a JSON file">
                <i class="fas fa-file-import"></i> Import State
            </button>
            <button class="btn btn-danger btn-export" onclick="resetState()" title="Reset all settings and states">
                <i class="fas fa-trash-alt"></i> Reset State
            </button>
        </div>

        <!-- Toast Container -->
        <div aria-live="polite" aria-atomic="true" class="position-relative">
            <div id="toastContainer" class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
                <!-- Toasts will be appended here -->
            </div>
        </div>

        <!-- Help Modal -->
        <div class="modal fade" id="helpModal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="helpModalLabel">Help & Instructions</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <h6>Overview</h6>
                        <p>This application allows you to randomly select URLs from a predefined list with customizable settings.</p>
                        <h6>Features</h6>
                        <ul>
                            <li><strong>URL Prefix/Suffix:</strong> Add prefixes or suffixes to all URLs before they are opened.</li>
                            <li><strong>Default Frequency:</strong> Set the default frequency for new items.</li>
                            <li><strong>Adjust Probabilities:</strong> Control the likelihood of selecting from Bucket1 or Bucket2.</li>
                            <li><strong>Draw History:</strong> View a log of the last 5 drawn URLs.</li>
                            <li><strong>Undo Last Draw:</strong> Revert the last draw action.</li>
                            <li><strong>Import/Export State:</strong> Save and load your current state using JSON files.</li>
                            <li><strong>Dark Mode:</strong> Toggle between light and dark themes for better visibility.</li>
                        </ul>
                        <h6>How to Use</h6>
                        <ol>
                            <li><strong>Set URL Prefix/Suffix</strong>: Enter any prefix or suffix you want to add to the URLs and click "Save URL Prefix/Suffix".</li>
                            <li><strong>Set Default Frequency</strong>: Click the "Edit" button next to "Default Frequency", enter a positive integer, and click "Save".</li>
                            <li><strong>Adjust Probabilities</strong>: Use the slider to set the probability of selecting from Bucket1 and Bucket2.</li>
                            <li><strong>Draw URL</strong>: Click "Draw and Open URL" to randomly select and open a URL based on the current settings.</li>
                            <li><strong>Undo Draw</strong>: If you accidentally draw a URL, click "Undo Last Draw" to revert the last action.</li>
                            <li><strong>View Buckets</strong>: Check the lists under Bucket1 and Bucket2 to see current items and their frequencies.</li>
                            <li><strong>View Draw History</strong>: Scroll through the "Draw History" section to see the last 5 drawn URLs.</li>
                            <li><strong>Import/Export State</strong>: Use the respective buttons to save your current state or load a previously saved state.</li>
                            <li><strong>Toggle Dark Mode</strong>: Click the "Dark Mode" button at the top-right to switch themes.</li>
                            <li><strong>Reset State</strong>: Click "Reset State" to clear all settings and start fresh.</li>
                        </ol>
                        <h6>Notes</h6>
                        <ul>
                            <li>Ensure that the <code>target</code> parameter in the URL matches the JSON file you intend to use.</li>
                            <li>Imported states will merge with existing states. Ensure that the <code>target</code> parameter corresponds to the intended data.</li>
                            <li>Toast notifications will appear at the bottom-right corner for various actions.</li>
                        </ul>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bootstrap JS and dependencies -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-wpsYrgENSMwvWDnK+0hqyc+8zhu+uZdzsOCS8KQmS1b2y2lZjY0Chvh6e+GD44G" crossorigin="anonymous"></script>
    </div>
</body>
</html>
