<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Drive-private PDF (GIS only)</title>

  <!-- Google Identity Services â€“ this is the ONLY Google JS you need -->
  <script src="https://accounts.google.com/gsi/client" defer></script>

  <style>html,body,iframe{margin:0;height:100%;width:100%;border:0}</style>
</head>
<body>
  <iframe id="pdf"></iframe>

  <script defer>
    /* ---------- CONFIG -------------------------------------------------- */
    const CLIENT_ID = '569755047834-3mn8irblfmqa8puatv1iapdaj1ug86s3.apps.googleusercontent.com';
    const FILE_ID   = '1w5-ntNxYHeZ8tcxN3nyOjshaS7YRQypc';  // Drive file
    const PAGE      = 21;                                    // start page
    const SCOPES    = 'https://www.googleapis.com/auth/drive.readonly';

    /* ---------- 1.  Ask Google for an access-token ---------------------- */
    window.addEventListener('DOMContentLoaded', () => {
      google.accounts.oauth2.initTokenClient({
        client_id: CLIENT_ID,
        scope    : SCOPES,
        prompt   : '',                    // silent if user is already signed-in
        callback : handleToken,
      }).requestAccessToken({prompt: 'consent'});  // fallback: show picker
    });

    /* ---------- 2.  Use fetch() + Bearer token to grab the bytes -------- */
    async function handleToken(resp) {
      if (resp.error) { alert(resp.error); return; }

      const pdfBlob = await fetch(
        `https://www.googleapis.com/drive/v3/files/${FILE_ID}?alt=media`,
        { headers: { Authorization: `Bearer ${resp.access_token}` } }
      ).then(r => r.ok ? r.blob() : Promise.reject(r.statusText));

      const url = URL.createObjectURL(pdfBlob);
      document.getElementById('pdf').src = `${url}#page=${PAGE}`;
    }
  </script>
</body>
</html>
