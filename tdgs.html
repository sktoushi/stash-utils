<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Private-Drive PDF Viewer</title>

  <!-- Google Identity Services (GIS) -->
  <script src="https://accounts.google.com/gsi/client" defer></script>

  <style>
    html,body,iframe {margin:0;height:100%;width:100%;border:0}
    body {font-family: sans-serif}
    #err {padding:2rem;color:#b00}
  </style>
</head>
<body>
  <iframe id="pdf" hidden></iframe>
  <div id="err" hidden></div>

  <script defer>
    /* â”€â”€â”€â”€  CONFIG  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    const CLIENT_ID = '569755047834-3mn8irblfmqa8puatv1iapdaj1ug86s3.apps.googleusercontent.com';
    const API_KEY   = 'AIzaSyCYSqmh8zBqybd9Sg2F_9bkMz3PYImmaw4';                         // from GCP â†’ Credentials
    const FILE_ID   = '1w5-ntNxYHeZ8tcxN3nyOjshaS7YRQypc';                   // 1w5-ntNâ€¦ etc.
    const PAGE_NUM  = 1;                                      // page to jump to
    const SCOPES    = 'https://www.googleapis.com/auth/drive.readonly';

    /* â”€â”€â”€â”€  MAIN  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    window.addEventListener('DOMContentLoaded', () => {
      google.accounts.oauth2.initTokenClient({
        client_id : CLIENT_ID,
        scope     : SCOPES,
        prompt    : '',
        callback  : onToken
      }).requestAccessToken({prompt:'consent'});  // shows picker if needed
    });

    async function onToken(resp) {
      if (resp.error) { return showError(resp.error); }

      const url = `https://www.googleapis.com/drive/v3/files/${FILE_ID}`
                + `?alt=media&supportsAllDrives=true&key=${API_KEY}`;

      try {
        const blob = await fetch(url, {
          headers: { Authorization: `Bearer ${resp.access_token}` }
        }).then(r => r.ok ? r.blob()
                          : r.json().then(e => Promise.reject(e.error.message)));

        const objUrl = URL.createObjectURL(blob);
        const iframe = document.getElementById('pdf');
        iframe.src   = `${objUrl}#page=${PAGE_NUM}`;
        iframe.hidden = false;
      } catch (err) {
        showError(err);
      }
    }

    function showError(msg) {
      document.getElementById('err').textContent = 'ðŸ’¥ ' + msg;
      document.getElementById('err').hidden = false;
      console.error(msg);
    }
  </script>
</body>
</html>
