<!DOCTYPE html>
<html lang="en">
<head>
    <!-- [Your existing head content remains the same] -->
</head>
<body>
    <!-- [Your existing body content remains the same] -->

    <script>
        // [Your existing JavaScript functions remain the same up to updateURL]

        // Update URL with the serialized activities and include initial URL params
        function updateURL(activities, initialWeight) {
            let encoded = serializeActivities(activities, initialWeight);
            let urlParams = new URLSearchParams(window.location.search);
            urlParams.delete('data'); // Remove existing 'data' parameter if any
            urlParams.set('data', encoded); // Set new 'data' parameter
            let newUrl = window.location.protocol + "//" + window.location.host + window.location.pathname + '?' + urlParams.toString();
            window.history.replaceState({ path: newUrl }, '', newUrl);
        }

        // [Rest of your JavaScript code remains the same]

        // Main function to handle activity selection, updating weights, and updating URL
        function main() {
            const urlParams = new URLSearchParams(window.location.search);
            const githubPrefix = urlParams.get('githubPrefix') || '';
            const maxIssueNumber = parseInt(urlParams.get('maxIssueNumber')) || 10;
            const initialWeight = parseFloat(urlParams.get('initialWeight')) || 1;
            const reductionCoefficient = parseFloat(urlParams.get('reductionCoefficient')) || 0.5;
            const encodedData = urlParams.get('data') || '';
            const name = urlParams.get('name') || ''; // Get the name parameter

            // Set the title with the name parameter
            const pickerTitle = document.getElementById('pickerTitle');
            pickerTitle.innerText = `Random Activity Picker (${name})`;

            // Deserialize activities or initialize if none exist
            let activities = deserializeActivities(encodedData, maxIssueNumber, initialWeight);

            // Render the activity table (sorted by weight)
            renderTable(activities, githubPrefix);

            document.getElementById('rollButton').addEventListener('click', function() {
                // Pick a random activity
                let selectedActivity = getRandomActivity(activities);
                document.getElementById('result').innerText = "Selected Activity: " + selectedActivity;

                // Update the weight and URL
                updateActivityWeight(selectedActivity, activities, reductionCoefficient);
                updateURL(activities, initialWeight);

                // Generate the activity URL and copy to clipboard
                let activityUrl = githubPrefix + selectedActivity;
                copyToClipboard(window.location.href); // This will now include all URL params

                // Redirect to the activity URL
                window.open(activityUrl);

                // Re-render the table after updating weights (sorted by weight)
                renderTable(activities, githubPrefix);
            });
        }

        // [Rest of your JavaScript code remains the same]
    </script>

    <!-- [Your existing scripts for Bootstrap JS and dependencies remain the same] -->
</body>
</html>
